<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавьте вывод текста к Человечек в «Виселице»</title>
</head>

<body>
    <canvas id="canvas" width="300" height="300"></canvas>

    <script src="https://code.jquery.com/jquery-2.1.0.js"></script>
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var width = canvas.width;
        var height = canvas.height;
        var blockSize = 10;
        ctx.strokeStyle = "Turquoise";
        ctx.lineWidth = 4;

        // создаем массив со словами
        let words = [
            /*"программа",
            "макака",
            "прекрасный",
            "оладушек",
            "картошка",
            "помидор",
            "огурец",
            "школа",
            "институт",
            "работа",
            "музыка",*/
            "кино"
        ];

        // выбираем рандомное слово для угадывания
        let word = words[Math.floor(Math.random() * words.length)];

        // создаем итоговый массив
        let answerArray = [];
        for (let i = 0; i < word.length; i++) {
            answerArray[i] = "_";
        };

        // массив не правильных ответов
        let wrongAnswer = [];

        // оставшиеся буквы
        let remainingLetters = word.length;

        // количество попыток
        let numberOfAttempts = remainingLetters * 2;
        // let numberOfAttempts = remainingLetters;

        // программируем игровой цикл
        while (remainingLetters > 0 && numberOfAttempts > 0) {
            alert(answerArray.join(" "));

            // запрашиваем вариант ответа и кладем ответ игрока в переменную guess
            let guess = prompt("Угадайте букву или нажмите Отмена для выхода из игры.");

            if (guess === null) {
                // если игрок нажал Отмена, то программа завершается и мы выходим из игрового цикла
                break;
            } else if (guess.length !== 1) {
                // если игрок введ более, чем одну букву, программа выдаст предупреждение
                alert("Пожалуйста, введите только одну букву.");
            } else {
                numberOfAttempts--;
                guess = guess.toLowerCase();
                
                // Обновляем состояние игры
                let guessFound = false;
                for (let j = 0; j < word.length; j++) {
                    if (word[j] === guess && answerArray[j] === "_") {
                        answerArray[j] = guess;
                        remainingLetters--;
                        guessFound = true;
                    };
                };

                // добавляем все не правильные буквы
                if (!guessFound) {
                    wrongAnswer.push(guess);
                };
            };
        };
        console.log("wrongAnswer arr is: " + wrongAnswer);

        alert(answerArray.join(" "));

        if (numberOfAttempts === 0) {
            alert("Увы, Вы не отгадали слово. Было загадано слово " + word);
        } else {
            alert("Отлично! Было загадано слово " + word);
        };

        function rightAnswer() {
            let rightAnswer = 0;
            let wrongAns = [];
            for (let i = 0; i < answerArray.length; i++) {
                if (answerArray[i] === "_") {
                    wrongAns.push(i);
                }
            }
            rightAnswer = answerArray.length - wrongAns.length;
            return rightAnswer;
        };

        function rightAnswerPrint(func) {
            let rightAnswer = func();
            if (rightAnswer === 0 || rightAnswer === 1) {
                ctx.strokeRect(100, 20, 20, 20); // голова
            } else if (rightAnswer === 2 || rightAnswer === 3) {
                ctx.strokeRect(100, 20, 20, 20); // голова
                ctx.beginPath();
                // тело
                ctx.moveTo(110, 40);
                ctx.lineTo(110, 90);
                // левая рука
                ctx.moveTo(110, 60);
                ctx.lineTo(90, 50);
                // правая рука
                ctx.moveTo(110, 60);
                ctx.lineTo(130, 50);
                ctx.stroke();
            } else if (rightAnswer === 4 || rightAnswer === 5) {
                ctx.strokeRect(100, 20, 20, 20); // голова
                ctx.beginPath();
                // тело
                ctx.moveTo(110, 40);
                ctx.lineTo(110, 90);
                // левая рука
                ctx.moveTo(110, 60);
                ctx.lineTo(90, 50);
                // правая рука
                ctx.moveTo(110, 60);
                ctx.lineTo(130, 50);
                // левая нога
                ctx.moveTo(110, 90);
                ctx.lineTo(90, 120);
                // правая нога
                ctx.moveTo(110, 90);
                ctx.lineTo(130, 120);
                ctx.stroke();
            }
        };
        rightAnswerPrint(rightAnswer);

        // убираем запятые из массива answerArray
        var ans = [answerArray].toString().replaceAll(',', '');
        if (alert == "Отлично!") {
            ans = [answerArray].replaceAll('_', '');
        };

        // рисуем слово
        var drawWord = function () {
            ctx.font = "20px Courier";
            ctx.fillStyle = "Black";
            ctx.textAlign = "left";
            ctx.letterSpacing = "8.5px";
            ctx.textBaseline = "top";
            ctx.fillText(ans, 18, 150);
        };

        // рисуем подчеркивание для слова
        var drawBorderWord = function () {
            ctx.fillStyle = "Black";

            let xCoord = 20;
            for (let i = 0; i < answerArray.length; i++) {
                ctx.fillRect(xCoord, 170, 10, 2);
                xCoord += 20;
            };
        };

        // рисуем неправильные ответы uniqueWrongAnswerArr
        var drawWrongAnswer = function () {
            ctx.font = "20px Courier";
            ctx.fillStyle = "Black";
            ctx.textAlign = "left";
            ctx.letterSpacing = "8.5px";
            ctx.textBaseline = "top";
            ctx.fillText(wrongAnswer, 18, 170);
        };

        // рисуем рамку
        var drawBorder = function () {
            ctx.fillStyle = "Gray";
            ctx.fillRect(0, 0, width, blockSize);
            ctx.fillRect(0, height - blockSize, width, blockSize);
            ctx.fillRect(0, 0, blockSize, height);
            ctx.fillRect(width - blockSize, 0, blockSize, height);
        };

        drawBorder();
        drawWord();
        drawBorderWord();
        drawWrongAnswer();

        /*
        3. Добавьте вывод текста к «Виселице»
        Усовершенствуйте игру, используя метод fillText для вывода текущего слова под человечком, как показано на рисунке. 
        Подсказка: для подчеркивания каждой буквы я использовал линии длиной 30 пикселей, с расстоянием 10 пикселей 
        между ними.
        Можете усложнить задачу — отображайте также неправильные ответы в виде зачеркнутых букв, как на рисунке справа.
        */

    </script>
</body>

</html>